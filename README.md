# go-etherem
 
交易所以太坊钱包

交易所系统中钱包服务它的主要功能包括：

1：为每个用户生成生成用户钱包
2：当监听地址发生新交易时获取通知
3：广播签名交易
4：处理ERC20代币(USDT)的充值


主要工具：
1：Ganache-cli (钱包仿真器，模拟eth节点)
2：redis 保持创建的地址，以及交易



1：生成用户钱包
   当收到新的create_account的restful请求时时，创建新的密钥对并存入密码库，(redis中hash数据)
   生成account_created消息并发送到队列的account_created主题(redis 中 stream数据)

2: 充值
    监听新区块，获取区块中的全部交易
    过滤掉与钱包地址无关的交易
    将每个相关的交易都发往队列
    
    生成transfer消息并发送到队列的deposit主题(redis 中 stream数据)

3：提币
  当收到transfer的restful请求时，把热钱包的资金转入到用户指定的钱包地址
  离线签名，并广播交易
  生成transfer消息并发送到队列的withdraw主题(redis 中 stream数据)


4:归集
  将充值地址上的资金归集到指定的地址（第一期使用直接转账的方式，二期需要使用智能合约方式（一次转账可以转出多个地址 ）
  生成transfer消息并发送到队列的collection主题(redis 中 stream数据)

  钱包的组成：
    A：用户钱包  B:归集钱包 C热钱包 D系统冷钱包 E：boss冷钱包 

用户钱包
    用户需要向交易所进行代币充值，需要给每一名用户分配一个地址，用于充值资金。

归集钱包：
    归集钱包的用途在于当用户钱包里的钱达到一定规模时需要进行资金归集，
    因为资金分放在零散的钱包地址中不方便管理，所以在达到一定条件的情况下需要把资金归集至归集钱包



30%会存放在热钱包中，这个钱包专门用于提供给客户提币的提币流动资金。
20%会存放在系统冷钱包中，系统冷钱包是离线钱包，只有当提现钱包资金不够时才会在系统冷钱包进行拨款。
50%会存放在老板的公司钱包中，这个钱包也是离线钱包。

相关技术文档在这里
https://github.com/miguelmota/ethereum-development-with-go-book